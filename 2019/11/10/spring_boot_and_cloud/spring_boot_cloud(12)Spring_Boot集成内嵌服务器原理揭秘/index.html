<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">

<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"ceaser.wang","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.12.1","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="断点SpringServletContainerInitializer我们在SpringServletContainerInitializer的onStartup方法里边加一个断点，然后debug应用，让我们感到奇怪的是断点并不会进入到onStartup方法，那么我们看一下顶层接口ServletContainerInitializer的实现类有哪些：">
<meta property="og:type" content="article">
<meta property="og:title" content="spring_boot_cloud(12)Spring_Boot集成内嵌服务器原理揭秘">
<meta property="og:url" content="https://ceaser.wang/2019/11/10/spring_boot_and_cloud/spring_boot_cloud(12)Spring_Boot%E9%9B%86%E6%88%90%E5%86%85%E5%B5%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8E%9F%E7%90%86%E6%8F%AD%E7%A7%98/index.html">
<meta property="og:site_name" content="南贺神社">
<meta property="og:description" content="断点SpringServletContainerInitializer我们在SpringServletContainerInitializer的onStartup方法里边加一个断点，然后debug应用，让我们感到奇怪的是断点并不会进入到onStartup方法，那么我们看一下顶层接口ServletContainerInitializer的实现类有哪些：">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://ceaser.wang/ServletContainerInitializer.png">
<meta property="og:image" content="https://ceaser.wang/ServletRegistrationBean.png">
<meta property="og:image" content="https://ceaser.wang/FilterRegistrationBean.png">
<meta property="og:image" content="https://ceaser.wang/tomcatStarter.png">
<meta property="og:image" content="https://ceaser.wang/tomcatStarter1.png">
<meta property="og:image" content="https://ceaser.wang/AbstractServletWebServerFactory.png">
<meta property="og:image" content="https://ceaser.wang/TomcatStarterPackage.png">
<meta property="article:published_time" content="2019-11-10T18:13:32.000Z">
<meta property="article:modified_time" content="2025-02-09T05:38:58.802Z">
<meta property="article:author" content="CeaserWang">
<meta property="article:tag" content="tomcat SpringBoot 容器">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ceaser.wang/ServletContainerInitializer.png">


<link rel="canonical" href="https://ceaser.wang/2019/11/10/spring_boot_and_cloud/spring_boot_cloud(12)Spring_Boot%E9%9B%86%E6%88%90%E5%86%85%E5%B5%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8E%9F%E7%90%86%E6%8F%AD%E7%A7%98/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://ceaser.wang/2019/11/10/spring_boot_and_cloud/spring_boot_cloud(12)Spring_Boot%E9%9B%86%E6%88%90%E5%86%85%E5%B5%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8E%9F%E7%90%86%E6%8F%AD%E7%A7%98/","path":"2019/11/10/spring_boot_and_cloud/spring_boot_cloud(12)Spring_Boot集成内嵌服务器原理揭秘/","title":"spring_boot_cloud(12)Spring_Boot集成内嵌服务器原理揭秘"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>spring_boot_cloud(12)Spring_Boot集成内嵌服务器原理揭秘 | 南贺神社</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">南贺神社</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">你写程序有写诗一样的感觉吗?</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">210</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">26</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">222</span></a></li><li class="menu-item menu-item-0xcc"><a href="/0xcc/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>0XCC</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%AD%E7%82%B9SpringServletContainerInitializer"><span class="nav-number">1.</span> <span class="nav-text">断点SpringServletContainerInitializer</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%A0%E7%BB%9F%E7%9A%84Spring-mvc%E7%9A%84%E5%AE%B9%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E8%BF%87%E7%A8%8B%EF%BC%9B"><span class="nav-number">1.1.</span> <span class="nav-text">传统的Spring mvc的容器初始化过程；</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8E%B0%E4%BB%A3%E7%9A%84Spring-Boot%E5%BA%94%E7%94%A8%E7%9A%84%E5%AE%B9%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E8%BF%87%E7%A8%8B%EF%BC%9A"><span class="nav-number">1.2.</span> <span class="nav-text">现代的Spring Boot应用的容器初始化过程：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Servlet-3-0-%E7%9A%84%E4%B8%80%E4%BA%9B%E9%87%8D%E8%A6%81%E7%89%B9%E6%80%A7%EF%BC%9A"><span class="nav-number">2.</span> <span class="nav-text">Servlet 3.0 的一些重要特性：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WebApplicationInitializer%E4%B8%8EServletContextInitializer%E7%9A%84%E5%85%B3%E7%B3%BB%E8%AF%A6%E8%A7%A3"><span class="nav-number">3.</span> <span class="nav-text">WebApplicationInitializer与ServletContextInitializer的关系详解</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Example"><span class="nav-number">3.1.</span> <span class="nav-text">Example</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#The-traditional-XML-based-approach"><span class="nav-number">3.1.1.</span> <span class="nav-text">The traditional, XML-based approach</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#The-code-based-approach-with-WebApplicationInitializer"><span class="nav-number">3.1.2.</span> <span class="nav-text">The code-based approach with WebApplicationInitializer</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#A-100-code-based-approach-to-configuration"><span class="nav-number">3.1.3.</span> <span class="nav-text">A 100% code-based approach to configuration</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BE%E4%BE%8B"><span class="nav-number">3.2.</span> <span class="nav-text">举例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BC%A0%E7%BB%9F%E7%9A%84web-xml%E6%96%B9%E5%BC%8F%E6%98%AF%E6%80%8E%E4%B9%88%E5%81%9A%E7%9A%84"><span class="nav-number">3.2.1.</span> <span class="nav-text">传统的web.xml方式是怎么做的</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8EWebApplicationInitializer%E4%BD%BF%E7%94%A8%E7%BC%96%E7%A8%8B%E5%BC%8F"><span class="nav-number">3.2.2.</span> <span class="nav-text">基于WebApplicationInitializer使用编程式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">3.2.3.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88TomcatStarter%E4%B8%8D%E4%BD%BF%E7%94%A8SpringServletContainerInitializer%E7%9A%84%E6%96%B9%E5%BC%8F%E5%8A%A0%E8%BD%BD%EF%BC%9F"><span class="nav-number">3.3.</span> <span class="nav-text">为什么TomcatStarter不使用SpringServletContainerInitializer的方式加载？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TomcatStarter%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">3.4.</span> <span class="nav-text">TomcatStarter启动过程</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="CeaserWang"
      src="/../0xcc/index/Uchiha.jpg">
  <p class="site-author-name" itemprop="name">CeaserWang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">222</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">210</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tLzExNTY3MjE4NzQ=" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;1156721874"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOmNlYXNlcndhbmdAb3V0bG9vay5jb20=" title="E-Mail → mailto:ceaserwang@outlook.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-user-friends fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly90d29kcmFnb25sYWtlLmNvbQ==" title="https:&#x2F;&#x2F;twodragonlake.com">TwoDragonLake</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly9yb290Y2x1c3Rlci5naXRodWIuaW8=" title="https:&#x2F;&#x2F;rootcluster.github.io">RootCluster</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly9tdXNlZmxvdy5pbw==" title="https:&#x2F;&#x2F;museflow.io">MuseFlow</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly9pbmNvZGVyLm9yZw==" title="https:&#x2F;&#x2F;incoder.org">BladeCode</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly9rYWlmYS5kZXY=" title="https:&#x2F;&#x2F;kaifa.dev">Alyenc</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmRhemhpZGF5b25nLmNu" title="https:&#x2F;&#x2F;blog.dazhidayong.cn">Killua</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly93d3cuY3lsb25nLmNvbQ==" title="https:&#x2F;&#x2F;www.cylong.com">Cylong</span>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://ceaser.wang/2019/11/10/spring_boot_and_cloud/spring_boot_cloud(12)Spring_Boot%E9%9B%86%E6%88%90%E5%86%85%E5%B5%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8E%9F%E7%90%86%E6%8F%AD%E7%A7%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/../0xcc/index/Uchiha.jpg">
      <meta itemprop="name" content="CeaserWang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="南贺神社">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="spring_boot_cloud(12)Spring_Boot集成内嵌服务器原理揭秘 | 南贺神社">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          spring_boot_cloud(12)Spring_Boot集成内嵌服务器原理揭秘
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-11-10 18:13:32" itemprop="dateCreated datePublished" datetime="2019-11-10T18:13:32+00:00">2019-11-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-09 05:38:58" itemprop="dateModified" datetime="2025-02-09T05:38:58+00:00">2025-02-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/spring-boot-cloud/" itemprop="url" rel="index"><span itemprop="name">spring_boot_cloud</span></a>
        </span>
    </span>

  
    <span id="/2019/11/10/spring_boot_and_cloud/spring_boot_cloud(12)Spring_Boot%E9%9B%86%E6%88%90%E5%86%85%E5%B5%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8E%9F%E7%90%86%E6%8F%AD%E7%A7%98/" class="post-meta-item leancloud_visitors" data-flag-title="spring_boot_cloud(12)Spring_Boot集成内嵌服务器原理揭秘" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h3 id="断点SpringServletContainerInitializer"><a href="#断点SpringServletContainerInitializer" class="headerlink" title="断点SpringServletContainerInitializer"></a>断点SpringServletContainerInitializer</h3><p>我们在SpringServletContainerInitializer的onStartup方法里边加一个断点，然后debug应用，让我们感到奇怪的是断点并不会进入到onStartup方法，那么我们看一下顶层接口ServletContainerInitializer的实现类有哪些：</p>
<span id="more"></span>
<p><img src="/ServletContainerInitializer.png" alt="ServletContainerInitializer.png"><br>会看到有TomcatStarter和还有我们的SpringServletContainerInitializer，这里不会进入断点的原因是如果我们是以jar包或者main方法的方式启动应用的时候会使用springboot内嵌的tomcat容器，如果我们使用传统的spring mvc或者war包的方式那么SpringServletContainerInitializer就会初始化，如果我们现在在TomcatStarter的onStartup方法加一个断点，那么断点一定会进入。</p>
<h4 id="传统的Spring-mvc的容器初始化过程；"><a href="#传统的Spring-mvc的容器初始化过程；" class="headerlink" title="传统的Spring mvc的容器初始化过程；"></a>传统的Spring mvc的容器初始化过程；</h4><ol>
<li>通过SpringServletContainerInitializer来负责对容器启动时的相关组件的初始化。</li>
<li>到底要初始化那些组件则是通过Servlet规范中所提供的注解HandlesTypes来指定的。</li>
<li>在SpringServletContainerInitializer中，其HandlesTypes注解则明确指定为了WebApplicationInitializer.class类型。</li>
<li>在SpringServletContainerInitializer的onStartup方法中，这主要完成了一些验证与组件装配的工作。</li>
<li>在SpringServletContainerInitializer的onStartup方法中，由于某些容器并未遵循servlet规范，导致虽然明确指定了HandlesTypes注解的类型为WebApplicationInitializer.class类型，但还是可能会存在将一些非法类型传递过来的情况；所以，该方法还对传递进来的具体类型进行了细致的判断，只有符合条件的类型才会被纳入到List<WebApplicationInitializer>集合中。</li>
<li>当以上判断完成以后，List<WebApplicationInitializer>就是接下来要进行初始化的组件了。</li>
<li>最后，通过遍历List<WebApplicationInitializer>列表，取出其中的每一个WebApplicationInitializer对象，调用这些对象的onStartup方法，完成组件的启动初始化工作。</li>
</ol>
<p>总结一下：<br>SpringServletContainerInitializer在整个初始过程中，其扮演的角色实际上是委托或是代理的角色，真正完成初始化工作的依旧是一个个WebApplicationInitializer实现类。</p>
<h4 id="现代的Spring-Boot应用的容器初始化过程："><a href="#现代的Spring-Boot应用的容器初始化过程：" class="headerlink" title="现代的Spring Boot应用的容器初始化过程："></a>现代的Spring Boot应用的容器初始化过程：</h4><ol>
<li>对于Spring Boot应用来说，他并未使用SpringServletContainerInitializer来进行容器的初始化，而是使用了TomcatStarter进行的。</li>
<li>TomcatStarter存在三点因素使得它无法通过SPI机制进行初始化，它没有不带参数的构造方法；它的声明并非public；其所在jar包并没有META-INF.services目录，当然也就不存在javax.servlet.ServletContainerInitializer的文件了。</li>
<li>综上，TomcaStarter并非通过SPI机制进行的查找与实例化。</li>
<li>本质上，TomcatStarter是通过Spring Boot框架new出来的。</li>
<li>与SpringServletContainerInitializer类似，TomcatStarter在容器的初始化过程中扮演着一个委托或是代理的角色，真正执行的初始化动作实际上是由所持有的ServletContextInitializer的onStartup方法来完成。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">class TomcatStarter implements ServletContainerInitializer &#123;</span><br><span class="line"></span><br><span class="line">	private static final Log logger = LogFactory.getLog(TomcatStarter.class);</span><br><span class="line"></span><br><span class="line">	private final ServletContextInitializer[] initializers;</span><br><span class="line"></span><br><span class="line">	private volatile Exception startUpException;</span><br><span class="line"></span><br><span class="line">	TomcatStarter(ServletContextInitializer[] initializers) &#123;</span><br><span class="line">		this.initializers = initializers;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void onStartup(Set&lt;Class&lt;?&gt;&gt; classes, ServletContext servletContext)</span><br><span class="line">			throws ServletException &#123;</span><br><span class="line">		try &#123;</span><br><span class="line">			for (ServletContextInitializer initializer : this.initializers) &#123;</span><br><span class="line">				initializer.onStartup(servletContext);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		catch (Exception ex) &#123;</span><br><span class="line">			this.startUpException = ex;</span><br><span class="line">			// Prevent Tomcat from logging and re-throwing when we know we can</span><br><span class="line">			// deal with it in the main thread, but log for information here.</span><br><span class="line">			if (logger.isErrorEnabled()) &#123;</span><br><span class="line">				logger.error(&quot;Error starting Tomcat context. Exception: &quot;</span><br><span class="line">						+ ex.getClass().getName() + &quot;. Message: &quot; + ex.getMessage());</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Exception getStartUpException() &#123;</span><br><span class="line">		return this.startUpException;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>TomcatStarter是ServletContainerInitializer的实现，并且记录ServletContextInitializer初始过程中的错误。<br>我们看一下ServletContextInitializer的doc:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@FunctionalInterface</span><br><span class="line">public interface ServletContextInitializer &#123;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * Configure the given &#123;@link ServletContext&#125; with any servlets, filters, listeners</span><br><span class="line">	 * context-params and attributes necessary for initialization.</span><br><span class="line">	 * @param servletContext the &#123;@code ServletContext&#125; to initialize</span><br><span class="line">	 * @throws ServletException if any call against the given &#123;@code ServletContext&#125;</span><br><span class="line">	 * throws a &#123;@code ServletException&#125;</span><br><span class="line">	 */</span><br><span class="line">	void onStartup(ServletContext servletContext) throws ServletException;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Interface used to configure a Servlet 3.0+ context programmatically. Unlike WebApplicationInitializer, classes that implement this interface (and do not implement WebApplicationInitializer) will not be detected by SpringServletContainerInitializer and hence will not be automatically bootstrapped by the Servlet container.<br>This interface is primarily designed to allow ServletContextInitializers to be managed by Spring and not the Servlet container.<br>For configuration examples see WebApplicationInitializer.</p>
<p>这是一个接口，以编程的方式配置Servlet 3.0+的上下文，与WebApplicationInitializer不同的是，实现了这是一个接口，以编程的方式配置Servlet 3.0+的上下文，与WebApplicationInitializer不同的是，实现了ServletContextInitializer接口的类（没有实现WebApplicationInitializer）将不会被SpringServletContainerInitializer检测到，因此它不会被servlet容器自动的进行启动。<br>这个接口的主要的设计目的是允许ServletContextInitializers被spring管理，而不是Servlet容器管理。</p>
<h3 id="Servlet-3-0-的一些重要特性："><a href="#Servlet-3-0-的一些重要特性：" class="headerlink" title="Servlet 3.0 的一些重要特性："></a>Servlet 3.0 的一些重要特性：</h3><p>ServletRegistration:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public interface ServletRegistration extends Registration &#123;</span><br><span class="line">    Set&lt;String&gt; addMapping(String... var1);</span><br><span class="line"></span><br><span class="line">    Collection&lt;String&gt; getMappings();</span><br><span class="line"></span><br><span class="line">    String getRunAsRole();</span><br><span class="line"></span><br><span class="line">    public interface Dynamic extends ServletRegistration, javax.servlet.Registration.Dynamic &#123;</span><br><span class="line">        void setLoadOnStartup(int var1);</span><br><span class="line"></span><br><span class="line">        Set&lt;String&gt; setServletSecurity(ServletSecurityElement var1);</span><br><span class="line"></span><br><span class="line">        void setMultipartConfig(MultipartConfigElement var1);</span><br><span class="line"></span><br><span class="line">        void setRunAsRole(String var1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ServletContext:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">public interface ServletContext &#123;</span><br><span class="line">    String TEMPDIR = &quot;javax.servlet.context.tempdir&quot;;</span><br><span class="line">    String ORDERED_LIBS = &quot;javax.servlet.context.orderedLibs&quot;;</span><br><span class="line"></span><br><span class="line">    String getContextPath();</span><br><span class="line"></span><br><span class="line">    ServletContext getContext(String var1);</span><br><span class="line"></span><br><span class="line">    int getMajorVersion();</span><br><span class="line"></span><br><span class="line">    int getMinorVersion();</span><br><span class="line"></span><br><span class="line">    int getEffectiveMajorVersion();</span><br><span class="line"></span><br><span class="line">    int getEffectiveMinorVersion();</span><br><span class="line"></span><br><span class="line">    String getMimeType(String var1);</span><br><span class="line"></span><br><span class="line">    Set&lt;String&gt; getResourcePaths(String var1);</span><br><span class="line"></span><br><span class="line">    URL getResource(String var1) throws MalformedURLException;</span><br><span class="line"></span><br><span class="line">    InputStream getResourceAsStream(String var1);</span><br><span class="line"></span><br><span class="line">    RequestDispatcher getRequestDispatcher(String var1);</span><br><span class="line"></span><br><span class="line">    RequestDispatcher getNamedDispatcher(String var1);</span><br><span class="line"></span><br><span class="line">    /** @deprecated */</span><br><span class="line">    @Deprecated</span><br><span class="line">    Servlet getServlet(String var1) throws ServletException;</span><br><span class="line"></span><br><span class="line">    /** @deprecated */</span><br><span class="line">    @Deprecated</span><br><span class="line">    Enumeration&lt;Servlet&gt; getServlets();</span><br><span class="line"></span><br><span class="line">    /** @deprecated */</span><br><span class="line">    @Deprecated</span><br><span class="line">    Enumeration&lt;String&gt; getServletNames();</span><br><span class="line"></span><br><span class="line">    void log(String var1);</span><br><span class="line"></span><br><span class="line">    /** @deprecated */</span><br><span class="line">    @Deprecated</span><br><span class="line">    void log(Exception var1, String var2);</span><br><span class="line"></span><br><span class="line">    void log(String var1, Throwable var2);</span><br><span class="line"></span><br><span class="line">    String getRealPath(String var1);</span><br><span class="line"></span><br><span class="line">    String getServerInfo();</span><br><span class="line"></span><br><span class="line">    String getInitParameter(String var1);</span><br><span class="line"></span><br><span class="line">    Enumeration&lt;String&gt; getInitParameterNames();</span><br><span class="line"></span><br><span class="line">    boolean setInitParameter(String var1, String var2);</span><br><span class="line"></span><br><span class="line">    Object getAttribute(String var1);</span><br><span class="line"></span><br><span class="line">    Enumeration&lt;String&gt; getAttributeNames();</span><br><span class="line"></span><br><span class="line">    void setAttribute(String var1, Object var2);</span><br><span class="line"></span><br><span class="line">    void removeAttribute(String var1);</span><br><span class="line"></span><br><span class="line">    String getServletContextName();</span><br><span class="line"></span><br><span class="line">    Dynamic addServlet(String var1, String var2);</span><br><span class="line"></span><br><span class="line">    Dynamic addServlet(String var1, Servlet var2);</span><br><span class="line"></span><br><span class="line">    Dynamic addServlet(String var1, Class&lt;? extends Servlet&gt; var2);</span><br><span class="line"></span><br><span class="line">    Dynamic addJspFile(String var1, String var2);</span><br><span class="line"></span><br><span class="line">    &lt;T extends Servlet&gt; T createServlet(Class&lt;T&gt; var1) throws ServletException;</span><br><span class="line"></span><br><span class="line">    ServletRegistration getServletRegistration(String var1);</span><br><span class="line"></span><br><span class="line">    Map&lt;String, ? extends ServletRegistration&gt; getServletRegistrations();</span><br><span class="line"></span><br><span class="line">    javax.servlet.FilterRegistration.Dynamic addFilter(String var1, String var2);</span><br><span class="line"></span><br><span class="line">    javax.servlet.FilterRegistration.Dynamic addFilter(String var1, Filter var2);</span><br><span class="line"></span><br><span class="line">    javax.servlet.FilterRegistration.Dynamic addFilter(String var1, Class&lt;? extends Filter&gt; var2);</span><br><span class="line"></span><br><span class="line">    &lt;T extends Filter&gt; T createFilter(Class&lt;T&gt; var1) throws ServletException;</span><br><span class="line"></span><br><span class="line">    FilterRegistration getFilterRegistration(String var1);</span><br><span class="line"></span><br><span class="line">    Map&lt;String, ? extends FilterRegistration&gt; getFilterRegistrations();</span><br><span class="line"></span><br><span class="line">    SessionCookieConfig getSessionCookieConfig();</span><br><span class="line"></span><br><span class="line">    void setSessionTrackingModes(Set&lt;SessionTrackingMode&gt; var1);</span><br><span class="line"></span><br><span class="line">    Set&lt;SessionTrackingMode&gt; getDefaultSessionTrackingModes();</span><br><span class="line"></span><br><span class="line">    Set&lt;SessionTrackingMode&gt; getEffectiveSessionTrackingModes();</span><br><span class="line"></span><br><span class="line">    void addListener(String var1);</span><br><span class="line"></span><br><span class="line">    &lt;T extends EventListener&gt; void addListener(T var1);</span><br><span class="line"></span><br><span class="line">    void addListener(Class&lt;? extends EventListener&gt; var1);</span><br><span class="line"></span><br><span class="line">    &lt;T extends EventListener&gt; T createListener(Class&lt;T&gt; var1) throws ServletException;</span><br><span class="line"></span><br><span class="line">    JspConfigDescriptor getJspConfigDescriptor();</span><br><span class="line"></span><br><span class="line">    ClassLoader getClassLoader();</span><br><span class="line"></span><br><span class="line">    void declareRoles(String... var1);</span><br><span class="line"></span><br><span class="line">    String getVirtualServerName();</span><br><span class="line"></span><br><span class="line">    int getSessionTimeout();</span><br><span class="line"></span><br><span class="line">    void setSessionTimeout(int var1);</span><br><span class="line"></span><br><span class="line">    String getRequestCharacterEncoding();</span><br><span class="line"></span><br><span class="line">    void setRequestCharacterEncoding(String var1);</span><br><span class="line"></span><br><span class="line">    String getResponseCharacterEncoding();</span><br><span class="line"></span><br><span class="line">    void setResponseCharacterEncoding(String var1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Servlet 3.0可以使用注解的方式增加filter、Servlet等，可以使用编程式的api，也可以使用web.xml的方式。</p>
<ol>
<li>ServletRegistration.Dynamic servlet &#x3D; servletContext.addServlet(MyServlet.class..getSimpleName(),MuServlet.class);<br> servlet.addMapping(“&#x2F;myServlet”);</li>
</ol>
<h3 id="WebApplicationInitializer与ServletContextInitializer的关系详解"><a href="#WebApplicationInitializer与ServletContextInitializer的关系详解" class="headerlink" title="WebApplicationInitializer与ServletContextInitializer的关系详解"></a>WebApplicationInitializer与ServletContextInitializer的关系详解</h3><p>WebApplicationInitializer接口：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public interface WebApplicationInitializer &#123;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * Configure the given &#123;@link ServletContext&#125; with any servlets, filters, listeners</span><br><span class="line">	 * context-params and attributes necessary for initializing this web application. See</span><br><span class="line">	 * examples &#123;@linkplain WebApplicationInitializer above&#125;.</span><br><span class="line">	 * @param servletContext the &#123;@code ServletContext&#125; to initialize</span><br><span class="line">	 * @throws ServletException if any call against the given &#123;@code ServletContext&#125;</span><br><span class="line">	 * throws a &#123;@code ServletException&#125;</span><br><span class="line">	 */</span><br><span class="line">	void onStartup(ServletContext servletContext) throws ServletException;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先看一下WebApplicationInitializer的doc：</p>
<p>Interface to be implemented in Servlet 3.0+ environments in order to configure the ServletContext programmatically – as opposed to (or possibly in conjunction with) the traditional web.xml-based approach.<br>Implementations of this SPI will be detected automatically by SpringServletContainerInitializer, which itself is bootstrapped automatically by any Servlet 3.0 container. See its Javadoc for details on this bootstrapping mechanism.</p>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><h5 id="The-traditional-XML-based-approach"><a href="#The-traditional-XML-based-approach" class="headerlink" title="The traditional, XML-based approach"></a>The traditional, XML-based approach</h5><p>Most Spring users building a web application will need to register Spring’s DispatcherServlet. For reference, in WEB-INF&#x2F;web.xml, this would typically be done as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">  &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;</span><br><span class="line">  &lt;servlet-class&gt;</span><br><span class="line">    org.springframework.web.servlet.DispatcherServlet</span><br><span class="line">  &lt;/servlet-class&gt;</span><br><span class="line">  &lt;init-param&gt;</span><br><span class="line">    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">    &lt;param-value&gt;/WEB-INF/spring/dispatcher-config.xml&lt;/param-value&gt;</span><br><span class="line">  &lt;/init-param&gt;</span><br><span class="line">  &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line"></span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">  &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;</span><br><span class="line">  &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure>
<h5 id="The-code-based-approach-with-WebApplicationInitializer"><a href="#The-code-based-approach-with-WebApplicationInitializer" class="headerlink" title="The code-based approach with WebApplicationInitializer"></a>The code-based approach with WebApplicationInitializer</h5><p>Here is the equivalent DispatcherServlet registration logic, WebApplicationInitializer-style:<br>   public class MyWebAppInitializer implements WebApplicationInitializer {</p>
<pre><code>  @Override
  public void onStartup(ServletContext container) &#123;
    XmlWebApplicationContext appContext = new XmlWebApplicationContext();
    appContext.setConfigLocation(&quot;/WEB-INF/spring/dispatcher-config.xml&quot;);

    ServletRegistration.Dynamic dispatcher =
      container.addServlet(&quot;dispatcher&quot;, new DispatcherServlet(appContext));
    dispatcher.setLoadOnStartup(1);
    dispatcher.addMapping(&quot;/&quot;);
  &#125;
</code></pre>
<p>   }<br>As an alternative to the above, you can also extend from org.springframework.web.servlet.support.AbstractDispatcherServletInitializer. As you can see, thanks to Servlet 3.0’s new ServletContext.addServlet method we’re actually registering an instance of the DispatcherServlet, and this means that the DispatcherServlet can now be treated like any other object – receiving constructor injection of its application context in this case.<br>This style is both simpler and more concise. There is no concern for dealing with init-params, etc, just normal JavaBean-style properties and constructor arguments. You are free to create and work with your Spring application contexts as necessary before injecting them into the DispatcherServlet.<br>Most major Spring Web components have been updated to support this style of registration. You’ll find that DispatcherServlet, FrameworkServlet, ContextLoaderListener and DelegatingFilterProxy all now support constructor arguments. Even if a component (e.g. non-Spring, other third party) has not been specifically updated for use within WebApplicationInitializers, they still may be used in any case. The Servlet 3.0 ServletContext API allows for setting init-params, context-params, etc programmatically.</p>
<h5 id="A-100-code-based-approach-to-configuration"><a href="#A-100-code-based-approach-to-configuration" class="headerlink" title="A 100% code-based approach to configuration"></a>A 100% code-based approach to configuration</h5><p>In the example above, WEB-INF&#x2F;web.xml was successfully replaced with code in the form of a WebApplicationInitializer, but the actual dispatcher-config.xml Spring configuration remained XML-based. WebApplicationInitializer is a perfect fit for use with Spring’s code-based @Configuration classes. See @Configuration Javadoc for complete details, but the following example demonstrates refactoring to use Spring’s AnnotationConfigWebApplicationContext in lieu of XmlWebApplicationContext, and user-defined @Configuration classes AppConfig and DispatcherConfig instead of Spring XML files. This example also goes a bit beyond those above to demonstrate typical configuration of the ‘root’ application context and registration of the ContextLoaderListener:<br>   public class MyWebAppInitializer implements WebApplicationInitializer {</p>
<pre><code>  @Override
  public void onStartup(ServletContext container) &#123;
    // Create the &#39;root&#39; Spring application context
    AnnotationConfigWebApplicationContext rootContext =
      new AnnotationConfigWebApplicationContext();
    rootContext.register(AppConfig.class);

    // Manage the lifecycle of the root application context
    container.addListener(new ContextLoaderListener(rootContext));

    // Create the dispatcher servlet&#39;s Spring application context
    AnnotationConfigWebApplicationContext dispatcherContext =
      new AnnotationConfigWebApplicationContext();
    dispatcherContext.register(DispatcherConfig.class);

    // Register and map the dispatcher servlet
    ServletRegistration.Dynamic dispatcher =
      container.addServlet(&quot;dispatcher&quot;, new DispatcherServlet(dispatcherContext));
    dispatcher.setLoadOnStartup(1);
    dispatcher.addMapping(&quot;/&quot;);
  &#125;
</code></pre>
<p>   }<br>As an alternative to the above, you can also extend from org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer. Remember that WebApplicationInitializer implementations are detected automatically – so you are free to package them within your application as you see fit.</p>
<p>这是一个在servlet3.0+环境下实现的一个接口，用来以编程的方式配置ServletContext，这种方式是和传统的web.xml相反的，或者也是可以和传统的方式搭配使用的。</p>
<p>这个SPI的实现可以被SpringServletContainerInitializer自动的探测到，SpringServletContainerInitializer本身又是可以被servlet3.0容器启动的。详细可以看文档。</p>
<h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><h5 id="传统的web-xml方式是怎么做的"><a href="#传统的web-xml方式是怎么做的" class="headerlink" title="传统的web.xml方式是怎么做的"></a>传统的web.xml方式是怎么做的</h5><p>大多数的用户构建一个web应用将需要注册一个spring的DispatcherServlet，下面列出了一个引用，是一个经典的web.xml的使用方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">	&lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;</span><br><span class="line">	&lt;servlet-class&gt;</span><br><span class="line">		org.springframework.web.servlet.DispatcherServlet</span><br><span class="line">	&lt;/servlet-class&gt;</span><br><span class="line">	&lt;init-param&gt;</span><br><span class="line">		&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">		&lt;param-value&gt;/WEB-INF/spring/dispatcher-config.xml&lt;/param-value&gt;</span><br><span class="line">	&lt;/init-param&gt;</span><br><span class="line">	&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line"></span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">	&lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;</span><br><span class="line">	&lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure>
<h5 id="基于WebApplicationInitializer使用编程式"><a href="#基于WebApplicationInitializer使用编程式" class="headerlink" title="基于WebApplicationInitializer使用编程式"></a>基于WebApplicationInitializer使用编程式</h5><p>下面是一个和web.xml等价的写法来注册DispatcherServlet的逻辑，WebApplicationInitializer的风格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class MyWebAppInitializer implements WebApplicationInitializer &#123;</span><br><span class="line"></span><br><span class="line">	 @Override</span><br><span class="line">	 public void onStartup(ServletContext container) &#123;</span><br><span class="line">		 XmlWebApplicationContext appContext = new XmlWebApplicationContext();</span><br><span class="line">		 appContext.setConfigLocation(&quot;/WEB-INF/spring/dispatcher-config.xml&quot;);</span><br><span class="line"></span><br><span class="line">		 ServletRegistration.Dynamic dispatcher =</span><br><span class="line">			 container.addServlet(&quot;dispatcher&quot;, new DispatcherServlet(appContext));</span><br><span class="line">		 dispatcher.setLoadOnStartup(1);</span><br><span class="line">		 dispatcher.addMapping(&quot;/&quot;);</span><br><span class="line">	 &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>作为上述实现方式的另外一种实现手段，你也可以继承org.springframework.web.servlet.support.AbstractDispatcherServletInitializer:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">public abstract class AbstractDispatcherServletInitializer extends AbstractContextLoaderInitializer &#123;</span><br><span class="line">	---- 略 ----</span><br><span class="line">	@Override</span><br><span class="line">	public void onStartup(ServletContext servletContext) throws ServletException &#123;</span><br><span class="line">		super.onStartup(servletContext);</span><br><span class="line">		registerDispatcherServlet(servletContext);</span><br><span class="line">	&#125;</span><br><span class="line">	protected void registerDispatcherServlet(ServletContext servletContext) &#123;</span><br><span class="line">		String servletName = getServletName();</span><br><span class="line">		Assert.hasLength(servletName, &quot;getServletName() must not return null or empty&quot;);</span><br><span class="line"></span><br><span class="line">		WebApplicationContext servletAppContext = createServletApplicationContext();</span><br><span class="line">		Assert.notNull(servletAppContext, &quot;createServletApplicationContext() must not return null&quot;);</span><br><span class="line"></span><br><span class="line">		FrameworkServlet dispatcherServlet = createDispatcherServlet(servletAppContext);</span><br><span class="line">		Assert.notNull(dispatcherServlet, &quot;createDispatcherServlet(WebApplicationContext) must not return null&quot;);</span><br><span class="line">		dispatcherServlet.setContextInitializers(getServletApplicationContextInitializers());</span><br><span class="line">		// 设置到servletContext</span><br><span class="line">		ServletRegistration.Dynamic registration = servletContext.addServlet(servletName, dispatcherServlet);</span><br><span class="line">		if (registration == null) &#123;</span><br><span class="line">			throw new IllegalStateException(&quot;Failed to register servlet with name &#x27;&quot; + servletName + &quot;&#x27;. &quot; +</span><br><span class="line">					&quot;Check if there is another servlet registered under the same name.&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		//设置启动顺序</span><br><span class="line">		registration.setLoadOnStartup(1);</span><br><span class="line">		//设置映射</span><br><span class="line">		registration.addMapping(getServletMappings());</span><br><span class="line">		registration.setAsyncSupported(isAsyncSupported());</span><br><span class="line">		// 过滤器设置</span><br><span class="line">		Filter[] filters = getServletFilters();</span><br><span class="line">		if (!ObjectUtils.isEmpty(filters)) &#123;</span><br><span class="line">			for (Filter filter : filters) &#123;</span><br><span class="line">				registerServletFilter(servletContext, filter);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		customizeRegistration(registration);</span><br><span class="line"> &#125;</span><br><span class="line">	---- 略 ----</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上就是servlet3.0+使用编程式api配置dispatcherServlet。<br>记住WebApplicationInitializer的所有实现都可以被自动探测到。<br>Ordering WebApplicationInitializer execution<br>WebApplicationInitializer implementations may optionally be annotated at the class level with Spring’s @Order annotation or may implement Spring’s Ordered interface. If so, the initializers will be ordered prior to invocation. This provides a mechanism for users to ensure the order in which servlet container initialization occurs. Use of this feature is expected to be rare, as typical applications will likely centralize all container initialization within a single WebApplicationInitializer.<br>WebApplicationInitializer执行的排序，WebApplicationInitializer可以被@Order注解在class级别进行标注，也可以实现spring的排序接口，如果是这样，初始化器在调用之前会进行一个排序，略。。。</p>
<p>Caveats<br>警告<br>web.xml versioning<br>web.xml 的版本化<br>WEB-INF&#x2F;web.xml and WebApplicationInitializer use are not mutually exclusive; for example, web.xml can register one servlet, and a WebApplicationInitializer can register another. An initializer can even modify registrations performed in web.xml through methods such as ServletContext.getServletRegistration(String). However, if WEB-INF&#x2F;web.xml is present in the application, its version attribute must be set to “3.0” or greater, otherwise ServletContainerInitializer bootstrapping will be ignored by the servlet container.<br>Mapping to ‘&#x2F;‘ under Tomcat<br>Apache Tomcat maps its internal DefaultServlet to “&#x2F;“, and on Tomcat versions &lt;&#x3D; 7.0.14, this servlet mapping cannot be overridden programmatically. 7.0.15 fixes this issue. Overriding the “&#x2F;“ servlet mapping has also been tested successfully under GlassFish 3.1.<br>WEB-INF&#x2F;web.xml和WebApplicationInitializer在使用上并不是互斥的，比如说web.xml 可以注册为一个servlet，WebApplicationInitializer也可以注册另外一个servlet，初始化器甚至可以通过ServletContext.getServletRegistration(String)方法修改在web.xml当中的注册，当然如果web.xml在应用中出现，那么其版本的属性应该设置成3.0或者更大，否则ServletContainerInitializer的启动将会被servlet容器忽略掉。<br>略。。。</p>
<h5 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h5><p>以往的web.xml到了3.0可以使用WebApplicationInitializer的方式替换，而WebApplicationInitializer使用的是spi的机制，可以被自动探测到，并且去执行；对于dispatcherServlet是一个非常重要的组件，所以spring干脆就提供了一个AbstractDispatcherServletInitializer抽象类以及它的实现类AbstractAnnotationConfigDispatcherServletInitializer帮助我们更为轻松的实例化dispatcherServlet。<br>关于传统的spring mvc和现代的spring boot应用组件之间的对应关系：</p>
<ol>
<li>SpringServletContainerInitializer对应TomcatStarter；<br> SpringServletContainerInitializer是通过spi机制，使用servlet 容器加载；TomcatStarter是spring容器new出来的。</li>
<li>WebApplicationInitializer对应TomcatStarter里边的ServletContextInitializer；</li>
</ol>
<h4 id="为什么TomcatStarter不使用SpringServletContainerInitializer的方式加载？"><a href="#为什么TomcatStarter不使用SpringServletContainerInitializer的方式加载？" class="headerlink" title="为什么TomcatStarter不使用SpringServletContainerInitializer的方式加载？"></a>为什么TomcatStarter不使用SpringServletContainerInitializer的方式加载？</h4><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NwcmluZy1wcm9qZWN0cy9zcHJpbmctYm9vdC9pc3N1ZXMvMzIx">https://github.com/spring-projects/spring-boot/issues/321<i class="fa fa-external-link-alt"></i></span><br>简而言之，当我们使用WAR包的时候，会有javax.servlet.ServletContainerInitializer自动加载，而当我们使用spring boot搞成jar包的时候，javax.servlet.ServletContainerInitializer的方式就不会生效，所以spring做了一个SpringServletContainerInitializer用来支持jar的方式运行app的支持。</p>
<p>当使用spring boot时，我们所编写的Servlet、Filter、Listener都是如何被检测的，加载和执行的呢？</p>
<ol>
<li>使用Servlet3.0+的注解，配合@ServletComponentScan。<br>定义一个Servlet class：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@WebServlet(&quot;myServlet&quot;)</span><br><span class="line">public class MyServlet extends HttpServlet &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line">        System.out.println(&quot;MyServlet Invoked&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
在启动类上加上@ServletComponentScan：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">@ServletComponentScan</span><br><span class="line">public class MyApplication  &#123;</span><br><span class="line">    private static  final Logger logger = LoggerFactory.getLogger(MyApplication.class);</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(MyApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
@ServletComponentScan 说明：<br>Enables scanning for Servlet components (filters, servlets, and listeners). Scanning is only performed when using an embedded web server.<br>Typically, one of value, basePackages, or basePackageClasses should be specified to control the packages to be scanned for components. In their absence, scanning will be performed from the package of the class with the annotation.<br>能够扫描Servlet组件（filters、servlets、listeners）。扫描只对嵌入式的web 服务器作起用。<br>一般来说需要指定basePackages，basePackageClasses中的一个用来控制可以被扫描到组件的package。<br>如果没有指定，那么就会从使用@ServletComponentScan注解的类所在的包开始扫描。</li>
<li>使用RegistrationBean（在spring boot内部得到了大量的应用）<br>定义Servlet：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class MyServlet2 extends HttpServlet &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line">        System.out.println(&quot;MyServlet2 Invoked&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
定义Filter：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class MyFilter implements Filter &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123;</span><br><span class="line">        System.out.println(&quot;MyFilter Invoked&quot;);</span><br><span class="line">        filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
注意在之前版本的servlet里边，Filter的三个方法init、doFilter、destroy都是必须要实现的，但是到了jdk1.8的时候提供了default method，我们可以不用强制去实现init和destroy，因为这两个方法变成default method了。<br>定义配置类ServletRegistrationConfig：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class ServletRegistrationConfig &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    public ServletRegistrationBean  myServletRegistrationBean()&#123;</span><br><span class="line">        ServletRegistrationBean servletRegistrationBean = new ServletRegistrationBean();</span><br><span class="line">        servletRegistrationBean.addUrlMappings(&quot;/myServlet2&quot;);</span><br><span class="line">        servletRegistrationBean.setServlet(new MyServlet2());</span><br><span class="line">        return servletRegistrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">		@Bean</span><br><span class="line">		public FilterRegistrationBean myFilterRegistrationBean()&#123;</span><br><span class="line">				FilterRegistrationBean filterRegistrationBean = new FilterRegistrationBean();</span><br><span class="line">				filterRegistrationBean.addUrlPatterns(&quot;/mServlet/*&quot;);</span><br><span class="line">				filterRegistrationBean.setFilter(new MyFilter());</span><br><span class="line">				return  filterRegistrationBean;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
以下ServletRegistrationBean和FilterRegistrationBean的继承结构，<br><img src="/ServletRegistrationBean.png" alt="ServletRegistrationBean.png"><br><img src="/FilterRegistrationBean.png" alt="FilterRegistrationBean.png"><br>找到最后的入口还是ServletContextInitializer，而ServletContextInitializer是内嵌服务的初始化入口。</li>
</ol>
<h4 id="TomcatStarter启动过程"><a href="#TomcatStarter启动过程" class="headerlink" title="TomcatStarter启动过程"></a>TomcatStarter启动过程</h4><p>首先我们在TomcatStarter的onStartup方法里边的for循环打一个断点：<br><img src="/tomcatStarter.png" alt="tomcatStarter.png"><br>可以看到TomcatStarter的成员变量initializers里边有三个元素，那么这三个元素是在什么时候初始化的呢？<br>然后在【initializer.onStartup(servletContext);】f7进入到onStartup的实现类里边，这个时候会进入到AbstractServletWebServerFactory的mergeInitializers方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">protected final ServletContextInitializer[] mergeInitializers(</span><br><span class="line">		ServletContextInitializer... initializers) &#123;</span><br><span class="line">	List&lt;ServletContextInitializer&gt; mergedInitializers = new ArrayList&lt;&gt;();</span><br><span class="line">	// 这个lambda表达式就是代表一个ServletContextInitializer</span><br><span class="line">	mergedInitializers.add((servletContext) -&gt; this.initParameters.forEach(servletContext::setInitParameter));</span><br><span class="line">	mergedInitializers.add(new SessionConfiguringInitializer(this.session));</span><br><span class="line">	mergedInitializers.addAll(Arrays.asList(initializers));</span><br><span class="line">	mergedInitializers.addAll(this.initializers);</span><br><span class="line">	return mergedInitializers.toArray(new ServletContextInitializer[0]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/tomcatStarter1.png" alt="tomcatStarter1.png"><br>此时mergedInitializers的三个元素和TomcatStarter里边的三个元素是一样的，那么我们就可以猜想TomcatStarter的成员变量initializers是由AbstractServletWebServerFactory初始化的，我们看一下AbstractServletWebServerFactory的层次结构，AbstractServletWebServerFactory看名字是抽象的web服务器工厂，就是生产web 服务的：<br><img src="/AbstractServletWebServerFactory.png" alt="AbstractServletWebServerFactory.png"><br>AbstractServletWebServerFactory下边有三个实现类，其中有一个是TomcatServletWebServerFactory，我们在TomcatServletWebServerFactory搜索TomcatStarter，找到了configureContext方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">protected void configureContext(Context context,ServletContextInitializer[] initializers) &#123;</span><br><span class="line">	TomcatStarter starter = new TomcatStarter(initializers);</span><br><span class="line">	if (context instanceof TomcatEmbeddedContext) &#123;</span><br><span class="line">		TomcatEmbeddedContext embeddedContext = (TomcatEmbeddedContext) context;</span><br><span class="line">		embeddedContext.setStarter(starter);</span><br><span class="line">		embeddedContext.setFailCtxIfServletStartFails(true);</span><br><span class="line">	&#125;</span><br><span class="line">	context.addServletContainerInitializer(starter, NO_CLASSES);</span><br><span class="line">	for (LifecycleListener lifecycleListener : this.contextLifecycleListeners) &#123;</span><br><span class="line">		context.addLifecycleListener(lifecycleListener);</span><br><span class="line">	&#125;</span><br><span class="line">	for (Valve valve : this.contextValves) &#123;</span><br><span class="line">		context.getPipeline().addValve(valve);</span><br><span class="line">	&#125;</span><br><span class="line">	for (ErrorPage errorPage : getErrorPages()) &#123;</span><br><span class="line">		new TomcatErrorPage(errorPage).addToContext(context);</span><br><span class="line">	&#125;</span><br><span class="line">	for (MimeMappings.Mapping mapping : getMimeMappings()) &#123;</span><br><span class="line">		context.addMimeMapping(mapping.getExtension(), mapping.getMimeType());</span><br><span class="line">	&#125;</span><br><span class="line">	configureSession(context);</span><br><span class="line">	new DisableReferenceClearingContextCustomizer().customize(context);</span><br><span class="line">	for (TomcatContextCustomizer customizer : this.tomcatContextCustomizers) &#123;</span><br><span class="line">		customizer.customize(context);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>configureContext会被prepareContext方法调用，在prepareContext里边会首先调用mergeInitializers，提前完成初始化TomactStarter里边需要的的ServletContextInitializer[]数组，上边提到的。<br>在这个方法里边，，调用了【	TomcatStarter starter &#x3D; new TomcatStarter(initializers);】构造了TomcatStarter。<br><img src="/TomcatStarterPackage.png" alt="TomcatStarterPackage.png"><br>TomcatStarter没有使用public的原因就是因为TomcatStarter和TomcatServletWebServerFactory属于同一个package，不需要修饰为public，他不希望TomcatStarter被其他的包的类去使用，这是一种保护设计。</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>CeaserWang
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://ceaser.wang/2019/11/10/spring_boot_and_cloud/spring_boot_cloud(12)Spring_Boot%E9%9B%86%E6%88%90%E5%86%85%E5%B5%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8E%9F%E7%90%86%E6%8F%AD%E7%A7%98/" title="spring_boot_cloud(12)Spring_Boot集成内嵌服务器原理揭秘">https://ceaser.wang/2019/11/10/spring_boot_and_cloud/spring_boot_cloud(12)Spring_Boot集成内嵌服务器原理揭秘/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/tomcat-SpringBoot-%E5%AE%B9%E5%99%A8/" rel="tag"><i class="fa fa-tag"></i> tomcat SpringBoot 容器</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/08/31/Concurrent/concurrency(3)%E6%AD%BB%E9%94%81%E6%A3%80%E6%B5%8B%E4%B8%8E%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7%E8%AF%A6%E8%A7%A3/" rel="prev" title="concurrency(3)死锁检测与相关工具详解">
                  <i class="fa fa-chevron-left"></i> concurrency(3)死锁检测与相关工具详解
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019/11/21/spring_boot_and_cloud/spring_boot_cloud(13)Value%E6%B3%A8%E8%A7%A3%E4%B8%8EBeanPostProcessor%E4%BD%9C%E7%94%A8%E4%B8%8E%E5%88%86%E6%9E%90/" rel="next" title="spring_boot_cloud(13)Value注解与BeanPostProcessor作用与分析">
                  spring_boot_cloud(13)Value注解与BeanPostProcessor作用与分析 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2015 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CeaserWang</span>
</div>
  <div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.1.1/mermaid.min.js","integrity":"sha256-8L3O8tirFUa8Va4NSTAyIbHJeLd6OnlcxgupV9F77e0="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>

  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>

  


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"ryAR9bttS7fex1FPEPAylmmJ-gzGzoHsz","app_key":"dYqygoN4Y01Bl38OdRoCHUYn","server_url":null,"security":false}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>



</body>
</html>
